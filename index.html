<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Local Marketplace — Single HTML MVP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ছোট অতিরিক্ত স্টাইল */
    .thumb { height: 120px; width: 100%; object-fit: cover; border-radius: 6px; }
    .ghost { opacity: .6; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="max-w-7xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold">Local Marketplace — Single File MVP</h1>
      <div class="flex items-center gap-3">
        <button id="btn-seller" class="px-3 py-1 bg-emerald-600 text-white rounded">Seller Dashboard</button>
        <button id="btn-export" class="px-3 py-1 bg-sky-600 text-white rounded">Export Data</button>
        <label class="bg-gray-200 px-3 py-1 rounded cursor-pointer">
          Import <input id="importFile" type="file" accept="application/json" class="hidden" />
        </label>
        <button id="btn-clear" class="px-3 py-1 bg-red-600 text-white rounded">Reset DB</button>
      </div>
    </header>

    <!-- Search / Filters / Sort -->
    <section class="mb-4 grid md:grid-cols-3 gap-3">
      <input id="q" placeholder="Search products..." class="p-2 border rounded col-span-2" />
      <select id="sort" class="p-2 border rounded">
        <option value="newest">Newest</option>
        <option value="price_asc">Price: Low → High</option>
        <option value="price_desc">Price: High → Low</option>
      </select>
      <div class="col-span-3 flex gap-2 items-center">
        <label class="text-sm">Price:</label>
        <input id="minPrice" type="number" placeholder="min" class="p-2 border rounded w-24" />
        <input id="maxPrice" type="number" placeholder="max" class="p-2 border rounded w-24" />
        <button id="btn-filter" class="px-3 py-1 bg-indigo-600 text-white rounded">Apply</button>
        <button id="btn-clear-filter" class="px-3 py-1 bg-gray-200 rounded">Clear</button>
      </div>
    </section>

    <main class="grid md:grid-cols-4 gap-6">
      <!-- Product Grid -->
      <section class="md:col-span-3">
        <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

        <!-- Pagination -->
        <div class="flex items-center justify-center gap-2 mt-4">
          <button id="prevPage" class="px-3 py-1 bg-gray-200 rounded">Prev</button>
          <div id="pageInfo" class="px-3 py-1"></div>
          <button id="nextPage" class="px-3 py-1 bg-gray-200 rounded">Next</button>
        </div>
      </section>

      <!-- Right column: Cart + Add product (seller quick) -->
      <aside class="space-y-6">
        <!-- Cart -->
        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-semibold mb-2">Cart</h3>
          <div id="cartList" class="space-y-2 text-sm"></div>
          <div class="mt-3 flex justify-between items-center">
            <div class="font-bold" id="cartTotal">৳0.00</div>
            <div>
              <button id="btn-clear-cart" class="px-3 py-1 bg-gray-200 rounded">Clear</button>
              <button id="btn-checkout" class="px-3 py-1 bg-indigo-600 text-white rounded">Checkout (Mock)</button>
            </div>
          </div>
        </div>

        <!-- Quick Add Product (visible in seller mode too) -->
        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-semibold mb-2">Quick add product</h3>
          <form id="quickAdd" class="space-y-2 text-sm">
            <input name="title" placeholder="Title" class="w-full p-2 border rounded" required />
            <input name="price" type="number" placeholder="Price (BDT)" class="w-full p-2 border rounded" />
            <input name="stock" type="number" placeholder="Stock" class="w-full p-2 border rounded" />
            <input name="image" type="file" accept="image/*" class="w-full p-1" />
            <div class="flex gap-2">
              <button class="px-3 py-1 bg-emerald-600 text-white rounded">Add</button>
              <button id="btn-seed" type="button" class="px-3 py-1 bg-gray-200 rounded">Add sample 3</button>
            </div>
          </form>
        </div>

        <!-- Seller toggle info -->
        <div id="sellerNote" class="bg-white p-3 rounded text-sm ghost">
          Seller dashboard closed. Click <strong>Seller Dashboard</strong> to open full seller panel.
        </div>
      </aside>
    </main>

    <!-- Seller Dashboard modal/panel (hidden by default) -->
    <div id="sellerPanel" class="fixed inset-0 bg-black/40 flex items-start justify-center p-6 hidden z-50">
      <div class="bg-white rounded shadow max-w-3xl w-full p-4 overflow-auto max-h-[90vh]">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-bold">Seller Dashboard</h2>
          <div class="flex gap-2">
            <button id="btn-close-seller" class="px-3 py-1 bg-gray-200 rounded">Close</button>
            <button id="btn-new-product" class="px-3 py-1 bg-emerald-600 text-white rounded">New Product</button>
          </div>
        </div>

        <!-- New / Edit product form -->
        <div id="sellerFormWrap" class="mb-4 hidden">
          <form id="sellerForm" class="grid grid-cols-1 gap-2">
            <input name="id" type="hidden" />
            <input name="title" placeholder="Title" class="p-2 border rounded" required />
            <textarea name="description" placeholder="Description" class="p-2 border rounded"></textarea>
            <div class="flex gap-2">
              <input name="price" type="number" placeholder="Price" class="p-2 border rounded w-1/2" />
              <input name="stock" type="number" placeholder="Stock" class="p-2 border rounded w-1/2" />
            </div>
            <input name="image" type="file" accept="image/*" class="p-1" />
            <div class="flex gap-2">
              <button class="px-3 py-1 bg-emerald-600 text-white rounded">Save</button>
              <button id="btn-cancel-seller" type="button" class="px-3 py-1 bg-gray-200 rounded">Cancel</button>
            </div>
          </form>
        </div>

        <!-- Seller products table -->
        <div>
          <h3 class="font-semibold mb-2">Your Products</h3>
          <div id="sellerProducts" class="space-y-2 text-sm"></div>
        </div>
      </div>
    </div>

    <!-- Toast area -->
    <div id="toast" class="fixed right-6 bottom-6"></div>

    <!-- Footer / Credits -->
    <footer class="mt-8 text-sm text-slate-600">Single-file demo • Data stored in your browser's localStorage • No server</footer>
  </div>

<script>
/*
  Single-file Marketplace - client-only
  - data stored in localStorage under key 'mkt_db_v1'
  - product object structure:
    { id, title, description, price, stock, images: [dataUrl], createdAt }
*/

(() => {
  // ---------- Utilities ----------
  const uid = (n=8) => Math.random().toString(36).slice(2,2+n);
  const now = () => new Date().toISOString();
  const STORAGE_KEY = 'mkt_db_v1';

  const toast = (msg, t=2500) => {
    const el = document.createElement('div');
    el.className = 'bg-black text-white px-4 py-2 rounded shadow mb-2';
    el.textContent = msg;
    document.getElementById('toast').appendChild(el);
    setTimeout(()=> el.remove(), t);
  };

  // ---------- DB layer (localStorage wrapper) ----------
  function loadDB() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return { products: [], orders: [] };
    try { return JSON.parse(raw); } catch(e) { return { products: [], orders: [] }; }
  }
  function saveDB(db) { localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }

  function resetDB() {
    localStorage.removeItem(STORAGE_KEY);
    initSampleData();
    toast('Database reset');
    render();
  }

  // ---------- Seed/sample data ----------
  function initSampleData() {
    const db = loadDB();
    if (db.products && db.products.length > 0) return; // do not overwrite
    const sample = [
      { title: 'Classic Leather Wallet', description: 'Genuine leather wallet with multiple slots', price: 599, stock: 50, images: [], createdAt: now() },
      { title: 'Wireless Earbuds X1', description: 'Bluetooth 5.3, noise-cancelling', price: 1599, stock: 100, images: [], createdAt: now() },
      { title: 'Stainless Steel Bottle 750ml', description: 'Vacuum insulated water bottle', price: 349, stock: 120, images: [], createdAt: now() }
    ];
    db.products = sample.map(p => ({ id: uid(10), ...p }));
    db.orders = [];
    saveDB(db);
  }

  // ---------- CRUD ----------
  function getProducts() { return loadDB().products || []; }
  function saveProducts(products) { const db = loadDB(); db.products = products; saveDB(db); }
  function addProduct(prod) { const products = getProducts(); products.unshift(prod); saveProducts(products); }
  function updateProduct(id, patch) {
    const products = getProducts().map(p => p.id === id ? { ...p, ...patch } : p);
    saveProducts(products);
  }
  function deleteProduct(id) {
    const products = getProducts().filter(p => p.id !== id);
    saveProducts(products);
  }

  // ---------- Cart ----------
  let cart = JSON.parse(localStorage.getItem('mkt_cart_v1') || '[]');
  function saveCart() { localStorage.setItem('mkt_cart_v1', JSON.stringify(cart)); }
  function addToCart(productId, qty=1) {
    const p = getProducts().find(x => x.id === productId);
    if (!p) { toast('Product not found'); return; }
    const idx = cart.findIndex(c => c.id === productId);
    if (idx === -1) cart.push({ id: productId, title: p.title, price: p.price, qty });
    else cart[idx].qty += qty;
    saveCart(); renderCart();
    toast('Added to cart');
  }
  function clearCart(){ cart = []; saveCart(); renderCart(); toast('Cart cleared'); }

  // ---------- UI render functions ----------
  const state = {
    q: '',
    sort: 'newest',
    page: 1,
    perPage: 9,
    minPrice: null,
    maxPrice: null,
  };

  function applyFilters(products) {
    let out = products.slice();
    if (state.q) {
      const q = state.q.toLowerCase();
      out = out.filter(p => (p.title||'').toLowerCase().includes(q) || (p.description||'').toLowerCase().includes(q));
    }
    if (state.minPrice != null) out = out.filter(p => p.price >= state.minPrice);
    if (state.maxPrice != null) out = out.filter(p => p.price <= state.maxPrice);
    if (state.sort === 'price_asc') out.sort((a,b)=>a.price-b.price);
    else if (state.sort === 'price_desc') out.sort((a,b)=>b.price-a.price);
    else out.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
    return out;
  }

  function renderProductsGrid() {
    const all = applyFilters(getProducts());
    const total = all.length;
    const pages = Math.max(1, Math.ceil(total / state.perPage));
    if (state.page > pages) state.page = pages;
    const start = (state.page - 1) * state.perPage;
    const pageItems = all.slice(start, start + state.perPage);

    const grid = document.getElementById('productGrid');
    grid.innerHTML = '';
    if (!pageItems.length) {
      grid.innerHTML = '<div class="col-span-full bg-white p-6 rounded shadow text-center">No products found.</div>';
    }
    for (const p of pageItems) {
      const card = document.createElement('div');
      card.className = 'bg-white p-4 rounded shadow flex flex-col';
      const imgSrc = (p.images && p.images[0]) ? p.images[0] : '';
      card.innerHTML = `
        ${imgSrc ? `<img src="${imgSrc}" alt="${escapeHTML(p.title)}" class="thumb mb-3">` : `<div class="h-36 mb-3 bg-gray-100 rounded flex items-center justify-center text-sm text-gray-500">No image</div>`}
        <h3 class="font-semibold">${escapeHTML(p.title)}</h3>
        <p class="text-sm text-slate-600 my-2">${escapeHTML(trunc(p.description, 120))}</p>
        <div class="mt-auto flex items-center justify-between gap-2">
          <div class="font-bold">৳${(p.price||0).toFixed(2)}</div>
          <div class="flex gap-2">
            <button data-id="${p.id}" class="btn-view px-2 py-1 bg-gray-200 rounded text-sm">View</button>
            <button data-id="${p.id}" class="btn-add px-2 py-1 bg-blue-600 text-white rounded text-sm">Add</button>
          </div>
        </div>
      `;
      grid.appendChild(card);
    }

    document.getElementById('pageInfo').textContent = `Page ${state.page} of ${pages} • ${total} items`;
    document.getElementById('prevPage').disabled = state.page <= 1;
    document.getElementById('nextPage').disabled = state.page >= pages;

    // attach buttons
    grid.querySelectorAll('.btn-add').forEach(b => b.addEventListener('click', e => {
      addToCart(e.currentTarget.dataset.id, 1);
    }));
    grid.querySelectorAll('.btn-view').forEach(b => b.addEventListener('click', e => {
      const id = e.currentTarget.dataset.id;
      openProductModal(id);
    }));
  }

  function renderCart() {
    const el = document.getElementById('cartList');
    el.innerHTML = '';
    if (!cart.length) { el.innerHTML = '<div>Cart is empty</div>'; document.getElementById('cartTotal').textContent = '৳0.00'; return; }
    let total = 0;
    for (const c of cart) {
      total += (c.price||0) * c.qty;
      const row = document.createElement('div');
      row.className = 'flex items-center justify-between';
      row.innerHTML = `
        <div class="text-sm">${escapeHTML(c.title)} x ${c.qty}</div>
        <div class="flex gap-2 items-center">
          <div class="font-medium">৳${((c.price||0)*c.qty).toFixed(2)}</div>
          <button data-id="${c.id}" class="btn-remove text-red-600 text-sm">✕</button>
        </div>
      `;
      el.appendChild(row);
    }
    el.querySelectorAll('.btn-remove').forEach(b => b.addEventListener('click', e => {
      const id = e.currentTarget.dataset.id;
      cart = cart.filter(x => x.id !== id);
      saveCart();
      renderCart();
    }));
    document.getElementById('cartTotal').textContent = `৳${total.toFixed(2)}`;
  }

  // render seller products in panel
  function renderSellerProducts() {
    const wrap = document.getElementById('sellerProducts');
    const prods = getProducts();
    wrap.innerHTML = '';
    if (!prods.length) wrap.innerHTML = '<div class="text-sm text-gray-500">No products yet</div>';
    for (const p of prods) {
      const card = document.createElement('div');
      card.className = 'p-2 border rounded flex items-start gap-3';
      const img = (p.images && p.images[0]) ? `<img src="${p.images[0]}" class="w-20 h-14 object-cover rounded" />` : `<div class="w-20 h-14 bg-gray-100 rounded flex items-center justify-center text-xs">No image</div>`;
      card.innerHTML = `
        ${img}
        <div class="flex-1">
          <div class="font-semibold">${escapeHTML(p.title)}</div>
          <div class="text-xs text-slate-600">৳${(p.price||0).toFixed(2)} • stock: ${p.stock || 0}</div>
        </div>
        <div class="flex flex-col gap-2">
          <button data-id="${p.id}" class="btn-edit px-2 py-1 bg-indigo-600 text-white rounded text-sm">Edit</button>
          <button data-id="${p.id}" class="btn-del px-2 py-1 bg-red-600 text-white rounded text-sm">Delete</button>
        </div>
      `;
      wrap.appendChild(card);
    }
    wrap.querySelectorAll('.btn-edit').forEach(b => b.addEventListener('click', e => {
      openSellerForm(e.currentTarget.dataset.id);
    }));
    wrap.querySelectorAll('.btn-del').forEach(b => b.addEventListener('click', e => {
      if (!confirm('Delete product?')) return;
      deleteProduct(e.currentTarget.dataset.id);
      renderSellerProducts();
      renderProductsGrid();
      toast('Product deleted');
    }));
  }

  // ---------- Product modal (simple) ----------
  function openProductModal(id) {
    const p = getProducts().find(x => x.id === id);
    if (!p) { toast('Product not found'); return; }
    // create modal
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
    modal.innerHTML = `
      <div class="bg-white rounded p-4 max-w-2xl w-full">
        <div class="flex justify-between items-start gap-4">
          <div class="flex-1">
            ${p.images && p.images[0] ? `<img src="${p.images[0]}" class="w-full h-64 object-cover rounded mb-3" />` : ''}
            <h3 class="text-xl font-semibold mb-1">${escapeHTML(p.title)}</h3>
            <div class="text-slate-600 mb-2">${escapeHTML(p.description||'No description')}</div>
            <div class="font-bold text-lg">৳${(p.price||0).toFixed(2)}</div>
            <div class="text-sm text-slate-500">Stock: ${p.stock || 0}</div>
          </div>
          <div class="w-36">
            <button id="modalAdd" class="w-full px-3 py-2 bg-blue-600 text-white rounded my-2">Add to cart</button>
            <button id="modalClose" class="w-full px-3 py-2 bg-gray-200 rounded">Close</button>
          </div>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
    modal.querySelector('#modalClose').addEventListener('click', () => modal.remove());
    modal.querySelector('#modalAdd').addEventListener('click', () => {
      addToCart(p.id, 1);
      modal.remove();
    });
  }

  // ---------- Seller form ----------
  function openSellerForm(id=null) {
    document.getElementById('sellerFormWrap').classList.remove('hidden');
    const form = document.getElementById('sellerForm');
    form.reset();
    if (!id) { form.id.value = ''; return; }
    const p = getProducts().find(x => x.id === id);
    if (!p) return;
    form.id.value = p.id;
    form.title.value = p.title || '';
    form.description.value = p.description || '';
    form.price.value = p.price || 0;
    form.stock.value = p.stock || 0;
  }

  // ---------- file to dataURL helper ----------
  function fileToDataUrl(file) {
    return new Promise((res, rej) => {
      const reader = new FileReader();
      reader.onload = e => res(e.target.result);
      reader.onerror = e => rej(e);
      reader.readAsDataURL(file);
    });
  }

  // ---------- Export / Import ----------
  function exportData() {
    const db = loadDB();
    const blob = new Blob([JSON.stringify(db, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'marketplace-data.json';
    a.click();
    URL.revokeObjectURL(url);
    toast('Exported data');
  }
  function importDataFile(file) {
    const reader = new FileReader();
    reader.onload = e => {
      try {
        const json = JSON.parse(e.target.result);
        if (!json.products) throw new Error('Invalid file');
        saveDB(json);
        render();
        toast('Imported data');
      } catch (err) {
        alert('Import failed: ' + err.message);
      }
    };
    reader.readAsText(file);
  }

  // ---------- Helpers ----------
  function trunc(s, n=120){ if (!s) return ''; return s.length > n ? s.slice(0,n-1)+'…' : s; }
  function escapeHTML(s=''){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  // ---------- Event wiring ----------
  document.getElementById('q').addEventListener('input', e => { state.q = e.target.value; state.page = 1; renderProductsGrid(); });
  document.getElementById('sort').addEventListener('change', e => { state.sort = e.target.value; renderProductsGrid(); });
  document.getElementById('btn-filter').addEventListener('click', () => {
    const min = document.getElementById('minPrice').value;
    const max = document.getElementById('maxPrice').value;
    state.minPrice = min !== '' ? parseFloat(min) : null;
    state.maxPrice = max !== '' ? parseFloat(max) : null;
    state.page = 1;
    renderProductsGrid();
  });
  document.getElementById('btn-clear-filter').addEventListener('click', () => {
    document.getElementById('minPrice').value = '';
    document.getElementById('maxPrice').value = '';
    state.minPrice = state.maxPrice = null;
    renderProductsGrid();
  });
  document.getElementById('prevPage').addEventListener('click', () => { if (state.page>1) { state.page--; renderProductsGrid(); }});
  document.getElementById('nextPage').addEventListener('click', () => { state.page++; renderProductsGrid(); });
  document.getElementById('btn-clear').addEventListener('click', () => { if (confirm('Reset all data?')) resetDB(); });

  // quick add form
  document.getElementById('quickAdd').addEventListener('submit', async (e) => {
    e.preventDefault();
    const f = e.target;
    const title = f.title.value.trim();
    const price = parseFloat(f.price.value||0);
    const stock = parseInt(f.stock.value||0);
    let images = [];
    if (f.image.files && f.image.files[0]) {
      try { images.push(await fileToDataUrl(f.image.files[0])); } catch(err){ console.error(err); }
    }
    const prod = { id: uid(10), title, description: '', price, stock, images, createdAt: now() };
    addProduct(prod);
    f.reset();
    render();
    toast('Product added');
  });

  // seed 3 sample products quick
  document.getElementById('btn-seed').addEventListener('click', () => {
    const samples = [
      { title: 'Eco Notebook A5', description: 'Recycled paper notebook', price: 199, stock: 50, images: [], createdAt: now() },
      { title: 'Portable Charger 10k', description: 'Fast charging powerbank', price: 1299, stock: 80, images: [], createdAt: now() },
      { title: 'Cotton T-Shirt', description: 'Comfortable everyday tee', price: 499, stock: 200, images: [], createdAt: now() },
    ];
    for (const s of samples) addProduct({ id: uid(10), ...s });
    render();
    toast('3 sample products added');
  });

  // seller dashboard toggles
  const sellerPanel = document.getElementById('sellerPanel');
  document.getElementById('btn-seller').addEventListener('click', () => {
    sellerPanel.classList.remove('hidden');
    document.getElementById('sellerNote').classList.add('hidden');
    renderSellerProducts();
  });
  document.getElementById('btn-close-seller').addEventListener('click', () => {
    sellerPanel.classList.add('hidden');
    document.getElementById('sellerFormWrap').classList.add('hidden');
    document.getElementById('sellerNote').classList.remove('hidden');
  });
  document.getElementById('btn-new-product').addEventListener('click', () => {
    openSellerForm(null);
  });
  document.getElementById('btn-cancel-seller').addEventListener('click', () => {
    document.getElementById('sellerFormWrap').classList.add('hidden');
  });

  document.getElementById('sellerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const f = e.target;
    const id = f.id.value;
    const title = f.title.value.trim();
    const description = f.description.value.trim();
    const price = parseFloat(f.price.value || 0);
    const stock = parseInt(f.stock.value || 0);
    let imgs = [];
    if (f.image.files && f.image.files[0]) {
      try { imgs.push(await fileToDataUrl(f.image.files[0])); } catch(err){ console.error(err); }
    }
    if (!id) {
      addProduct({ id: uid(10), title, description, price, stock, images: imgs, createdAt: now() });
      toast('Product created');
    } else {
      const patch = { title, description, price, stock };
      if (imgs.length) patch.images = imgs;
      updateProduct(id, patch);
      toast('Product updated');
    }
    f.reset();
    document.getElementById('sellerFormWrap').classList.add('hidden');
    renderSellerProducts();
    renderProductsGrid();
  });

  // seller products render when modal open - done in show function

  // export / import
  document.getElementById('btn-export').addEventListener('click', exportData);
  document.getElementById('importFile').addEventListener('change', (e)=> {
    const f = e.target.files[0];
    if (f) importDataFile(f);
    e.target.value = '';
  });

  // checkout
  document.getElementById('btn-checkout').addEventListener('click', () => {
    if (!cart.length) return alert('Cart empty');
    // simple mock: create order obj and save to DB.orders
    const db = loadDB();
    const order = { id: uid(12), createdAt: now(), items: cart, total: cart.reduce((s,i)=>s + (i.price||0)*i.qty, 0) };
    db.orders = db.orders || [];
    db.orders.push(order);
    saveDB(db);
    cart = [];
    saveCart();
    renderCart();
    renderProductsGrid();
    toast('Order placed (mock). Check export to see orders.');
  });

  // clear cart
  document.getElementById('btn-clear-cart').addEventListener('click', () => {
    if (!confirm('Clear cart?')) return;
    clearCart();
  });

  // export sample / reset
  document.getElementById('btn-export').addEventListener('click', exportData);
  document.getElementById('btn-clear').addEventListener('click', () => {
    if (confirm('Reset all data?')) resetDB();
  });

  // import file span above wired

  // quick product edit from seller panel wired when openSellerForm called

  // handle Escape key to close seller modal
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      sellerPanel.classList.add('hidden');
      document.getElementById('sellerFormWrap').classList.add('hidden');
    }
  });

  // helper to save sample on first load
  initSampleData();

  // initial render
  function render() {
    renderProductsGrid();
    renderCart();
    renderSellerProducts();
  }

  // load persisted cart into local variable
  try { cart = JSON.parse(localStorage.getItem('mkt_cart_v1') || '[]'); } catch(e){ cart = []; }
  render();

  // small helper for product modal escape effect on background click
  // (not required)

})();
</script>
</body>
</html>
